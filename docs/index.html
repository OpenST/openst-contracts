<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>OpenST Payments Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.lumen.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">OpenST Payments</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-lib_web3_events_formatter-web3EventsDecoder.html">lib/web3/events/formatter~web3EventsDecoder</a></li><li><a href="module-lib_web3_events_formatter-web3EventsFormatter.html">lib/web3/events/formatter~web3EventsFormatter</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-helpers_basic_helper.html">helpers/basic_helper</a></li><li><a href="module-lib_airdrop_management_adjust_airdrop_amount.html">lib/airdrop_management/adjust_airdrop_amount</a></li><li><a href="module-lib_cache_management_airdrop_cache.html">lib/cache_management/airdrop_cache</a></li><li><a href="module-lib_cache_management_pricer_cache.html">lib/cache_management/pricer_cache</a></li><li><a href="module-lib_contract_interact_airdrop.html">lib/contract_interact/airdrop</a></li><li><a href="module-lib_contract_interact_branded_token.html">lib/contract_interact/branded_token</a></li><li><a href="module-lib_contract_interact_helper.html">lib/contract_interact/helper</a></li><li><a href="module-lib_contract_interact_ops_managed_contract.html">lib/contract_interact/ops_managed_contract</a></li><li><a href="module-lib_contract_interact_owned_contract.html">lib/contract_interact/owned_contract</a></li><li><a href="module-lib_contract_interact_pricer.html">lib/contract_interact/pricer</a></li><li><a href="module-lib_contract_interact_workers.html">lib/contract_interact/workers</a></li><li><a href="module-lib_query_builder_mysql.html">lib/query_builder/mysql</a></li><li><a href="module-lib_set_worker_and_ops.html">lib/set_worker_and_ops</a></li><li><a href="module-lib_transaction_helper.html">lib/transaction_helper</a></li><li><a href="module-lib_web3_events_formatter.html">lib/web3/events/formatter</a></li><li><a href="module-tools_deploy_DeployHelper.html">tools/deploy/DeployHelper</a></li><li><a href="module-tools_deploy_EIP20TokenMock.html">tools/deploy/EIP20TokenMock</a></li><li><a href="module-tools_deploy_helper.html">tools/deploy/helper</a></li><li><a href="module-tools_deploy_pricer.html">tools/deploy/pricer</a></li><li><a href="module-tools_deploy_workers.html">tools/deploy/workers</a></li><li><a href="module-tools_dynamo_db_init.html">tools/dynamo_db_init</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="AirdropModelCacheKlass.html">AirdropModelCacheKlass</a></li><li><a href="baseCacheManagementKlass.html">baseCacheManagementKlass</a></li><li><a href="baseCacheMultiManagementKlass.html">baseCacheMultiManagementKlass</a></li><li><a href="module-helpers_basic_helper-BasicHelperKlass.html">helpers/basic_helper~BasicHelperKlass</a></li><li><a href="module-lib_airdrop_management_adjust_airdrop_amount-AdjustAirdropAmountKlass.html">lib/airdrop_management/adjust_airdrop_amount~AdjustAirdropAmountKlass</a></li><li><a href="module-lib_cache_management_airdrop_cache-AirdropBalanceCache.html">lib/cache_management/airdrop_cache~AirdropBalanceCache</a></li><li><a href="module-lib_cache_management_pricer_cache-PricerCache.html">lib/cache_management/pricer_cache~PricerCache</a></li><li><a href="module-lib_contract_interact_airdrop-Airdrop.html">lib/contract_interact/airdrop~Airdrop</a></li><li><a href="module-lib_contract_interact_branded_token-BrandedToken.html">lib/contract_interact/branded_token~BrandedToken</a></li><li><a href="module-lib_contract_interact_helper-ContractInteractHelper.html">lib/contract_interact/helper~ContractInteractHelper</a></li><li><a href="module-lib_contract_interact_ops_managed_contract-OpsManagedContract.html">lib/contract_interact/ops_managed_contract~OpsManagedContract</a></li><li><a href="module-lib_contract_interact_owned_contract-OwnedContract.html">lib/contract_interact/owned_contract~OwnedContract</a></li><li><a href="module-lib_contract_interact_pricer-MockToken.html">lib/contract_interact/pricer~MockToken</a></li><li><a href="module-lib_contract_interact_pricer-Pricer.html">lib/contract_interact/pricer~Pricer</a></li><li><a href="module-lib_contract_interact_workers-Workers.html">lib/contract_interact/workers~Workers</a></li><li><a href="module-lib_query_builder_mysql-MySQLQueryBuilderKlass.html">lib/query_builder/mysql~MySQLQueryBuilderKlass</a></li><li><a href="module-lib_set_worker_and_ops-SetWorkerOps.html">lib/set_worker_and_ops~SetWorkerOps</a></li><li><a href="module-lib_transaction_helper-TransactionHelper.html">lib/transaction_helper~TransactionHelper</a></li><li><a href="module-tools_dynamo_db_init-DynamoDBInit.html">tools/dynamo_db_init~DynamoDBInit</a></li><li><a href="userAirdropDetailCache.html">userAirdropDetailCache</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#rootPrefix">rootPrefix</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-8">
	
		<div id="main">
			

	
	











	
	





    <section class="readme-section">
        <article><h1>OpenST Payments - Advance Payment infrastructure on top of the <a href="https://simpletoken.org">OpenST network</a></h1><p><a href="https://www.npmjs.com/package/@openstfoundation/openst-payments"><img src="https://img.shields.io/npm/v/@openstfoundation/openst-payments.svg?maxAge=3600" alt="Latest version"></a>
<a href="https://travis-ci.org/OpenSTFoundation/openst-payments"><img src="https://img.shields.io/travis/OpenSTFoundation/openst-payments.svg?maxAge=600" alt="Travis"></a>
<a href="https://www.npmjs.com/package/@openstfoundation/openst-payments"><img src="https://img.shields.io/npm/dm/@openstfoundation/openst-payments.svg?maxAge=3600" alt="Downloads per month"></a>
<a href="https://gitter.im/OpenSTFoundation/SimpleToken"><img src="https://img.shields.io/badge/gitter-JOIN%20CHAT-brightgreen.svg" alt="Gitter: JOIN CHAT"></a></p>
<p>While OpenST 0.9 is available as-is for anyone to use, we caution that this is early stage software and under heavy ongoing development and improvement. Please report bugs and suggested improvements.</p>
<h1>Install OpenST Payments</h1><pre class="prettyprint source lang-bash"><code>npm install @openstfoundation/openst-payments --save</code></pre><h1>Init DynamoDB</h1><p>Following commands need to be run once, only for the first time. DynamoDB initial migrations for shard management are 
run in it and one shard is created and registered for storing token balance.</p>
<pre class="prettyprint source lang-bash"><code>. ./mocha_test/scripts/set_env_vars.sh
node tools/dynamo_db_init.js</code></pre><h1>Run Test Chain</h1><pre class="prettyprint source lang-bash"><code>cd mocha_test/scripts/
sh start_test_chain.sh</code></pre><h1>Set EVN Variables</h1><h3>Setup Initial Setup Variables:</h3><pre class="prettyprint source lang-bash"><code>export OST_UTILITY_GETH_RPC_PROVIDER=''
export OST_UTILITY_GETH_WS_PROVIDER=''
export OST_UTILITY_DEPLOYER_ADDR=''
export OST_UTILITY_DEPLOYER_PASSPHRASE=''
export OST_UTILITY_OPS_ADDR=''
export OST_UTILITY_OPS_PASSPHRASE=''</code></pre><h3>Deploy Branded Token Contract:</h3><pre class="prettyprint source lang-bash"><code>node tools/deploy/EIP20TokenMock.js conversionRate symbol name decimals gasPrice</code></pre><h3>Deploy Workers Contract:</h3><pre class="prettyprint source lang-bash"><code>node tools/deploy/workers.js gasPrice chainId</code></pre><h3>Deploy Airdrop Contract:</h3><pre class="prettyprint source lang-bash"><code>node tools/deploy/airdrop.js brandedTokenContractAddress baseCurrency workerContractAddress airdropBudgetHolder gasPrice chainId</code></pre><h3>Set Caching Engine:</h3><pre class="prettyprint source lang-bash"><code>export OST_CACHING_ENGINE='none'
For using redis/memcache as cache engine refer - [OpenSTFoundation/ost-price-oracle](https://github.com/OpenSTFoundation/ost-price-oracle)</code></pre><h3>Set DB Details For Payments/Airdrop:</h3><pre class="prettyprint source lang-bash"><code>export OP_MYSQL_HOST=''
export OP_MYSQL_USER=''
export OP_MYSQL_PASSWORD=''
export OP_MYSQL_DATABASE=''
export OP_MYSQL_CONNECTION_POOL_SIZE='5'</code></pre><h3>Create Airdrop Tables:</h3><pre class="prettyprint source lang-bash"><code>node migrations/create_tables.js </code></pre><h1>Deploy Service Examples:</h1><pre class="prettyprint source lang-js"><code>const OpenSTPayment = require('@openstfoundation/openst-payments')
  , Deploy = OpenSTPayment.services.deploy
;  
  // Deploy Workers
  const deployWorkerObject = new Deploy.workers({
    gas_price: gasPrice,
    options: {returnType: 'txHash'}
  });
  deployWorkerObject.perform();

  // Deploy Airdrop
  const deployAirdropObject = new Deploy.airdrop({
    branded_token_contract_address: brandedTokenAddress,
    base_currency: baseCurrency,
    worker_contract_address: workerContractAddress,
    airdrop_budget_holder: airdropBudgetHolder,
    gas_price: gasPrice,
    options: {returnType: 'txHash'}
  });
  deployAirdropObject.perform();
</code></pre><h1>OpsManaged Service Examples</h1><pre class="prettyprint source lang-js"><code>const OpenSTPayment = require('@openstfoundation/openst-payments')
  , OpsManaged = OpenSTPayment.services.opsManaged
;  
  // Set Ops Address
  const setOpsObject = new OpsManaged.setOps({
    contract_address: contractAddress,
    gas_price: gasPrice,
    chain_id: chainId,
    deployer_address: deployerAddress,
    deployer_passphrase: deployerPassphrase,
    ops_address: opsAddress,
    options: {returnType: 'txHash'}
  });
  setOpsObject.perform();

  // Get Ops Address
  const getOpsObject = new OpsManaged.getOps({
    contract_address: contractAddress,
    gas_price: gasPrice,
    chain_id: chainId
  });
  getOpsObject.perform();</code></pre><h1>Workers Service Examples</h1><pre class="prettyprint source lang-js"><code>const OpenSTPayment = require('@openstfoundation/openst-payments')
  , Workers = OpenSTPayment.services.workers
;  
  // Set Worker
  const setWorkerObject = new Workers.setWorker({
      workers_contract_address: constants.workersContractAddress,
      sender_address: constants.ops,
      sender_passphrase: constants.opsPassphrase,
      worker_address: workerAddress,
      deactivation_height: deactivationHeight.toString(10),
      gas_price: gasPrice,
      chain_id: chainId,
      options: {returnType: 'txHash'}
  });
  setWorkerObject.perform();

  // Is Worker
  const isWorkerObject = new Workers.isWorker({
      workers_contract_address: workersContractAddress,
      worker_address: workerAddress,
      chain_id: chainId
  });
  isWorkerObject.perform();</code></pre><h1>Airdrop Management Service Examples:</h1><pre class="prettyprint source lang-js"><code>const OpenSTPayment = require('@openstfoundation/openst-payments')
  , AirdropManager = OpenSTPayment.services.airdropManager
;  
  // Register Airdrop
  const registerObject = new AirdropManager.register({
    airdrop_contract_address: airdropContractAddress,
    chain_id: chainId
  });
  registerObject.perform();

  // Set Price Oracle
  const setPriceOracleObject = new AirdropManager.setPriceOracle({
      airdrop_contract_address: airdropContractAddress,
      chain_id: chainId,
      sender_address: senderAddress,
      sender_passphrase: senderPassphrase,
      currency: currency,
      price_oracle_contract_address: priceOracleContractAddress,
      gas_price: gasPrice,
      options: {tag: 'airdrop.setPriceOracle', returnType: 'txHash'}
  });
  setPriceOracleObject.perform();

  // Set Accepted Margin
  const setAcceptedMarginObject = new AirdropManager.setAcceptedMargin({
    airdrop_contract_address: airdropContractAddress,
    chain_id: chainId,
    sender_address: senderAddress,
    sender_passphrase: senderPassphrase,
    currency: currency,
    accepted_margin: acceptedMargin,
    gas_price: gasPrice,
    options: {tag: 'airdrop.setAcceptedMargin', returnType: 'txHash'}
  });
  setAcceptedMarginObject.perform();

  // Transfer Amount to airdrop budget holder
  const transferObject = new AirdropManager.transfer({
    sender_address: senderAddress,
    sender_passphrase: senderPassphrase,
    airdrop_contract_address: airdropContractAddress,
    amount: airdropBudgetAmountInWei,
    gas_price: gasPrice,
    chain_id: chainId,
    options: {tag: 'airdrop.transfer', returnType: 'txHash'}
  });
  transferObject.perform();

  // Approve airdrop budget holder
  const approveObject = new AirdropManager.approve({
    airdrop_contract_address: airdropContractAddress,
    airdrop_budget_holder_passphrase: airdropBudgetHolderPassphrase,
    gas_price: gasPrice,
    chain_id: chainId,
    options: {tag: 'airdrop.approve', returnType: 'txHash'}
  });
  approveObject.perform();

  // Allocate airdrop amount to users in batch
  const batchAllocatorObject = new AirdropManager.batchAllocator({
    airdrop_contract_address: airdropContractAddress,
    transaction_hash: transactionHash,
    airdrop_users: {userAddress1: {airdropAmount: amountInWei, expiryTimestamp: 0}, userAddress2: {airdropAmount: amountInWei, expiryTimestamp: 0}},
    chain_id: chainId
  });
  batchAllocatorObject.perform();

  // Get Users Airdrop Balance
  const userBalanceObject = new AirdropManager.userBalance({
    airdrop_contract_address: airdropContractAddress,
    chain_id: chainId,
    user_addresses: [user1, user2]
  });
  userBalanceObject.perform();

  // Call Pay method
  const payObject = new AirdropManager.pay({
    airdrop_contract_address: airdropContractAddress,
    chain_id: chainId,
    sender_worker_address: workerAddress,
    sender_worker_passphrase: workerPassphrase,
    beneficiary_address: beneficiary,
    transfer_amount: transferAmount.toString(10),
    commission_beneficiary_address: commissionBeneficiary,
    commission_amount: commissionAmount.toString(10),
    currency: currency,
    intended_price_point: intendedPricePoint,
    spender: spenderAddress,
    gas_price: gasPrice,
    options: {tag:'airdrop.pay', returnType: 'txHash'}
  });
  payObject.perform()
</code></pre><p>For further implementation details, please refer to the <a href="https://openstfoundation.github.io/openst-payments/">API documentation</a>.</p></article>
    </section>







		</div>
	</div>

	<div class="clearfix"></div>

	
		<div class="col-md-3">
			<div id="toc" class="col-md-3 hidden-xs hidden-sm hidden-md"></div>
		</div>
	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>

	<style>.copyright, .jsdoc-message, footer { color: #555555;} footer { border-color:#eeeeee;} }</style>


	<span class="copyright">
	OpenST Foundation Ltd.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>